===============================================
Database Import Instructions
===============================================

To import the complete database with all tables and data, follow these steps:

1. Open Terminal

2. Run the following commands (you'll be prompted for your password):

   # Connect to PostgreSQL as superuser
   sudo -u postgres psql

   # Inside psql, run these commands:
   -- Create a new database
   DROP DATABASE IF EXISTS medic_db_new;
   CREATE DATABASE medic_db_new WITH TEMPLATE template0 OWNER medic_db;
   \c medic_db_new

   -- Disable triggers to allow full import
   SET session_replication_role = 'replica';

   -- Import the backup (use the modified file)
   \i /tmp/modified_backup.sql

   -- Fix sequence values
   SELECT setval('public.api_customuser_id_seq', (SELECT MAX(id) FROM public.api_customuser), true);
   SELECT setval('public.api_hospital_id_seq', (SELECT MAX(id) FROM public.api_hospital), true);
   SELECT setval('public.api_department_id_seq', (SELECT MAX(id) FROM public.api_department), true);
   SELECT setval('public.api_doctor_id_seq', (SELECT MAX(id) FROM public.api_doctor), true);
   SELECT setval('public.api_hospitaladmin_id_seq', (SELECT MAX(id) FROM public.api_hospitaladmin), true);
   SELECT setval('public.api_medicalrecord_id_seq', (SELECT MAX(id) FROM public.api_medicalrecord), true);
   
   -- Re-enable triggers
   SET session_replication_role = 'origin';

   -- Check import results
   SELECT COUNT(*) AS user_count FROM public.api_customuser;
   SELECT COUNT(*) AS hospital_count FROM public.api_hospital;
   SELECT COUNT(*) AS doctor_count FROM public.api_doctor;
   SELECT COUNT(*) AS department_count FROM public.api_department;
   SELECT COUNT(*) AS record_count FROM public.api_medicalrecord;
   SELECT COUNT(*) AS appointment_count FROM public.api_appointment;
   
   -- Check for your specific account
   SELECT COUNT(*) FROM public.api_customuser WHERE email = 'eruwagolden55@gmail.com';

   -- Exit psql
   \q

3. After successful import, update your .env file:

   DB_NAME=medic_db_new

4. Alternatively, you can rename the database:

   sudo -u postgres psql -c "ALTER DATABASE medic_db_new RENAME TO medic_db;"
   (This will replace your existing database)

5. Remember that all security features are preserved:
   - Domain validation for hospital email addresses
   - Required hospital code verification
   - Mandatory 2FA for all hospital admins
   - Enhanced security with trusted device tracking
   - Rate limiting after 3 failed attempts
   - Account lockout for 15 minutes after 5 failed attempts

Note: If you have any issues during import, you can continue using your current database with the
manually created user account (eruwagolden55@gmail.com).
===============================================
