{% extends "email/base_email.html" %}

{% block content %}
<div class="email-container">
    <div class="header">
        <h1>New Prescription Request {% if urgency == 'urgent' %}üö®{% else %}üìã{% endif %}</h1>
    </div>

    <div class="content">
        <p>Hello Dr. {{ doctor_name }},</p>

        {% if urgency == 'urgent' %}
        <div class="urgent-alert">
            <h3>‚ö†Ô∏è URGENT REQUEST - IMMEDIATE ATTENTION REQUIRED</h3>
            <p>This prescription request has been marked as urgent and requires priority review.</p>
        </div>
        {% endif %}

        <p>A new prescription request requires your review and approval.</p>

        <div class="request-summary">
            <h3>Request Details</h3>
            <div class="detail-row">
                <span class="label">Patient Name:</span>
                <span class="value">{{ patient_name }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Patient HPN:</span>
                <span class="value">{{ patient_hpn }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Reference Number:</span>
                <span class="value">{{ request_reference }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Request Date:</span>
                <span class="value">{{ request_date }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Priority:</span>
                <span class="value">{% if urgency == 'urgent' %}<strong style="color: #d32f2f;">üö® URGENT</strong>{% else %}Routine{% endif %}</span>
            </div>
        </div>

        <div class="patient-info">
            <h3>Patient Information</h3>
            <div class="detail-row">
                <span class="label">Date of Birth:</span>
                <span class="value">{{ patient_dob }}</span>
            </div>
            <div class="detail-row">
                <span class="label">Age:</span>
                <span class="value">{{ patient_age }} years</span>
            </div>
            {% if allergies %}
            <div class="detail-row">
                <span class="label">Known Allergies:</span>
                <span class="value" style="color: #d32f2f; font-weight: bold;">{{ allergies }}</span>
            </div>
            {% endif %}
        </div>

        <div class="medications-list">
            <h3>Requested Medications ({{ medication_count }})</h3>
            <table class="medication-table">
                <thead>
                    <tr>
                        <th>Medication</th>
                        <th>Type</th>
                        <th>Reason</th>
                    </tr>
                </thead>
                <tbody>
                    {% for medication in medications %}
                    <tr>
                        <td>
                            <strong>{{ medication.name }}</strong><br>
                            <small>{{ medication.strength }} - {{ medication.form }}</small>
                        </td>
                        <td>
                            {% if medication.is_repeat %}
                            <span class="badge badge-repeat">Repeat</span>
                            {% else %}
                            <span class="badge badge-new">New</span>
                            {% endif %}
                        </td>
                        <td>{{ medication.reason|default:"Not specified" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if request_notes %}
        <div class="patient-notes">
            <h3>Patient's Additional Notes</h3>
            <p style="font-style: italic;">"{{ request_notes }}"</p>
        </div>
        {% endif %}

        <div class="pharmacy-info">
            <h3>Nominated Pharmacy</h3>
            <p><strong>{{ pharmacy_name }}</strong></p>
            <p>{{ pharmacy_address }}</p>
        </div>

        <div class="action-required">
            <h3>Action Required üéØ</h3>
            <p>Please review this request and take one of the following actions:</p>
            <ul>
                <li><strong>Approve:</strong> Issue prescription with specified quantities and dosage instructions</li>
                <li><strong>Reject:</strong> Decline request with clinical reasoning</li>
                <li><strong>Request More Information:</strong> Contact patient for additional details</li>
            </ul>
            {% if urgency == 'urgent' %}
            <p style="color: #d32f2f; font-weight: bold;">‚è∞ SLA: This urgent request should be reviewed within 1-3 business days.</p>
            {% else %}
            <p>‚è∞ Standard SLA: Please review within 7-10 business days.</p>
            {% endif %}
        </div>

        <div class="cta-button">
            <a href="{{ frontend_url }}/professional/prescriptions" class="button">Review Request in Dashboard</a>
        </div>

        <div class="footer-note">
            <p>This is an automated notification. Please do not reply to this email.</p>
            <p>Log in to your professional dashboard to manage prescription requests.</p>
        </div>
    </div>
</div>

<style>
    .email-container {
        max-width: 600px;
        margin: 0 auto;
        font-family: Arial, sans-serif;
    }

    .header {
        background-color: #6a1b9a;
        color: white;
        padding: 20px;
        text-align: center;
        border-radius: 5px 5px 0 0;
    }

    .header h1 {
        color: white;
        margin: 0;
    }

    .content {
        padding: 20px;
        background-color: #ffffff;
        border-radius: 0 0 5px 5px;
    }

    .urgent-alert {
        background-color: #ffebee;
        border: 2px solid #f44336;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        text-align: center;
    }

    .urgent-alert h3 {
        color: #c62828;
        margin: 0 0 10px 0;
    }

    .urgent-alert p {
        color: #d32f2f;
        font-weight: bold;
        margin: 0;
    }

    .request-summary {
        background-color: #f3e5f5;
        padding: 20px;
        border-radius: 5px;
        margin: 20px 0;
        border-left: 4px solid #6a1b9a;
    }

    .request-summary h3 {
        margin-top: 0;
        color: #4a148c;
    }

    .patient-info {
        background-color: #e1f5fe;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
    }

    .patient-info h3 {
        margin-top: 0;
        color: #01579b;
    }

    .detail-row {
        margin: 10px 0;
        display: flex;
        justify-content: space-between;
    }

    .label {
        font-weight: bold;
        color: #666;
    }

    .value {
        color: #333;
    }

    .medications-list {
        background-color: #f5f5f5;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
    }

    .medications-list h3 {
        margin-top: 0;
        color: #424242;
    }

    .medication-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }

    .medication-table th {
        background-color: #e0e0e0;
        padding: 10px;
        text-align: left;
        font-weight: bold;
        border-bottom: 2px solid #bdbdbd;
    }

    .medication-table td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
    }

    .badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 3px;
        font-size: 12px;
        font-weight: bold;
    }

    .badge-repeat {
        background-color: #4caf50;
        color: white;
    }

    .badge-new {
        background-color: #ff9800;
        color: white;
    }

    .patient-notes {
        background-color: #fff9e6;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        border-left: 3px solid #ffc107;
    }

    .patient-notes h3 {
        margin-top: 0;
        color: #f57c00;
    }

    .pharmacy-info {
        background-color: #e8f5e9;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
    }

    .pharmacy-info h3 {
        margin-top: 0;
        color: #2e7d32;
    }

    .action-required {
        background-color: #fff3e0;
        padding: 15px;
        border-radius: 5px;
        margin: 20px 0;
        border-left: 4px solid #ff6f00;
    }

    .action-required h3 {
        margin-top: 0;
        color: #e65100;
    }

    .action-required ul {
        margin: 10px 0;
        padding-left: 20px;
    }

    .cta-button {
        text-align: center;
        margin: 30px 0;
    }

    .button {
        display: inline-block;
        background-color: #6a1b9a;
        color: white !important;
        padding: 15px 30px;
        text-decoration: none;
        border-radius: 5px;
        font-weight: bold;
        font-size: 16px;
    }

    .button:hover {
        background-color: #4a148c;
    }

    .footer-note {
        border-top: 1px solid #eee;
        margin-top: 20px;
        padding-top: 20px;
        color: #666;
        text-align: center;
        font-size: 14px;
    }
</style>
{% endblock %}
