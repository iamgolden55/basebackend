# Generated by Django 5.1.3 on 2025-02-25 02:11

import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='AppointmentFee',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('fee_type', models.CharField(choices=[('general', 'General Consultation'), ('specialist', 'Specialist Consultation'), ('emergency', 'Emergency Consultation'), ('follow_up', 'Follow-up Visit'), ('video', 'Video Consultation')], default='standard', max_length=50)),
                ('base_fee', models.DecimalField(decimal_places=2, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('currency', models.CharField(choices=[('USD', 'US Dollar'), ('EUR', 'Euro'), ('GBP', 'British Pound'), ('NGN', 'Nigerian Naira')], default='NGN', max_length=3)),
                ('registration_fee', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('medical_card_fee', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('insurance_coverage_percentage', models.PositiveIntegerField(default=0, help_text='Percentage of fee covered by insurance', validators=[django.core.validators.MinValueValidator(0)])),
                ('senior_citizen_discount', models.PositiveIntegerField(default=0, help_text='Percentage discount for senior citizens', validators=[django.core.validators.MinValueValidator(0)])),
                ('valid_from', models.DateField()),
                ('valid_until', models.DateField(blank=True, null=True)),
                ('is_active', models.BooleanField(default=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='appointment_fees', to='api.department')),
                ('doctor', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='appointment_fees', to='api.doctor')),
                ('hospital', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='appointment_fees', to='api.hospital')),
            ],
            options={
                'ordering': ['-created_at'],
                'unique_together': {('hospital', 'department', 'doctor', 'fee_type')},
            },
        ),
        migrations.CreateModel(
            name='Appointment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('appointment_id', models.CharField(help_text='Unique identifier for the appointment', max_length=50, unique=True)),
                ('appointment_type', models.CharField(choices=[('first_visit', 'First Visit'), ('follow_up', 'Follow Up'), ('consultation', 'Consultation'), ('procedure', 'Procedure'), ('test', 'Medical Test'), ('vaccination', 'Vaccination'), ('therapy', 'Therapy')], default='consultation', max_length=20)),
                ('priority', models.CharField(choices=[('normal', 'Normal'), ('urgent', 'Urgent'), ('emergency', 'Emergency')], default='normal', max_length=20)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('confirmed', 'Confirmed'), ('in_progress', 'In Progress'), ('completed', 'Completed'), ('cancelled', 'Cancelled'), ('no_show', 'No Show'), ('rescheduled', 'Rescheduled'), ('referred', 'Referred'), ('rejected', 'Rejected')], default='pending', max_length=20)),
                ('appointment_date', models.DateTimeField()),
                ('duration', models.PositiveIntegerField(default=30, help_text='Duration in minutes')),
                ('chief_complaint', models.TextField(blank=True, help_text='Primary reason for visit')),
                ('symptoms', models.TextField(blank=True, help_text='Description of symptoms')),
                ('medical_history', models.TextField(blank=True, help_text='Relevant medical history')),
                ('allergies', models.TextField(blank=True, help_text='Known allergies')),
                ('current_medications', models.TextField(blank=True, help_text='Current medications')),
                ('is_insurance_based', models.BooleanField(default=False)),
                ('insurance_details', models.JSONField(blank=True, null=True)),
                ('payment_required', models.BooleanField(default=True)),
                ('payment_status', models.CharField(choices=[('pending', 'Payment Pending'), ('partial', 'Partial Payment'), ('completed', 'Payment Completed'), ('waived', 'Payment Waived'), ('insurance', 'Insurance Processing'), ('refunded', 'Refunded')], default='pending', max_length=20)),
                ('approval_date', models.DateTimeField(blank=True, null=True)),
                ('approval_notes', models.TextField(blank=True, null=True)),
                ('referral_reason', models.TextField(blank=True, null=True)),
                ('referral_date', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True, help_text='Additional notes about the appointment')),
                ('cancellation_reason', models.TextField(blank=True, help_text='Reason for cancellation if applicable')),
                ('reminder_sent', models.BooleanField(default=False)),
                ('last_reminder_sent', models.DateTimeField(blank=True, null=True)),
                ('cancelled_at', models.DateTimeField(blank=True, null=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_appointments', to=settings.AUTH_USER_MODEL)),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='appointments', to='api.department')),
                ('doctor', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='appointments', to='api.doctor')),
                ('hospital', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='appointments', to='api.hospital')),
                ('patient', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='appointments', to=settings.AUTH_USER_MODEL)),
                ('referred_to_hospital', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='referred_appointments', to='api.hospital')),
                ('fee', models.ForeignKey(null=True, on_delete=django.db.models.deletion.PROTECT, related_name='appointments', to='api.appointmentfee')),
            ],
            options={
                'ordering': ['-appointment_date'],
                'permissions': [('can_approve_appointments', 'Can approve appointments'), ('can_refer_appointments', 'Can refer appointments'), ('can_view_all_appointments', 'Can view all appointments')],
            },
        ),
        migrations.CreateModel(
            name='AppointmentNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(default=django.utils.timezone.now)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('notification_type', models.CharField(choices=[('email', 'Email'), ('sms', 'SMS'), ('in_app', 'In-App Notification'), ('whatsapp', 'WhatsApp')], max_length=20)),
                ('event_type', models.CharField(choices=[('booking_confirmation', 'Booking Confirmation'), ('appointment_reminder', 'Appointment Reminder'), ('appointment_update', 'Appointment Update'), ('appointment_cancellation', 'Appointment Cancellation'), ('appointment_rescheduled', 'Appointment Rescheduled'), ('payment_reminder', 'Payment Reminder'), ('payment_confirmation', 'Payment Confirmation'), ('doctor_unavailable', 'Doctor Unavailable'), ('referral_notification', 'Referral Notification'), ('follow_up_reminder', 'Follow-up Reminder'), ('emergency_notification', 'Emergency Notification'), ('test_results_available', 'Test Results Available'), ('pre_appointment_instructions', 'Pre-appointment Instructions')], max_length=30)),
                ('subject', models.CharField(max_length=255)),
                ('message', models.TextField()),
                ('template_name', models.CharField(blank=True, help_text='Template to use for notification', max_length=100, null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('scheduled_time', models.DateTimeField()),
                ('sent_time', models.DateTimeField(blank=True, null=True)),
                ('error_message', models.TextField(blank=True)),
                ('retry_count', models.PositiveIntegerField(default=0)),
                ('max_retries', models.PositiveIntegerField(default=3)),
                ('opened_at', models.DateTimeField(blank=True, help_text='When recipient opened the notification', null=True)),
                ('clicked_at', models.DateTimeField(blank=True, help_text='When recipient clicked any links', null=True)),
                ('next_retry_at', models.DateTimeField(blank=True, help_text='Next scheduled retry time', null=True)),
                ('appointment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to='api.appointment')),
                ('recipient', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='appointment_notifications', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AppointmentReminder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('reminder_type', models.CharField(choices=[('email', 'Email'), ('sms', 'SMS'), ('push', 'Push Notification'), ('whatsapp', 'WhatsApp')], max_length=20)),
                ('scheduled_time', models.DateTimeField()),
                ('time_before_appointment', models.DurationField(help_text='Time before appointment to send reminder')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('failed', 'Failed'), ('cancelled', 'Cancelled')], default='pending', max_length=20)),
                ('subject', models.CharField(help_text='Subject line for email reminders', max_length=255)),
                ('message', models.TextField(help_text='Reminder message content')),
                ('recipient_name', models.CharField(max_length=255)),
                ('recipient_contact', models.CharField(help_text='Email address or phone number', max_length=255)),
                ('sent_at', models.DateTimeField(blank=True, null=True)),
                ('delivery_status', models.CharField(blank=True, help_text='Delivery status from provider', max_length=50)),
                ('error_message', models.TextField(blank=True, help_text='Error message if delivery failed')),
                ('opened_at', models.DateTimeField(blank=True, help_text='When recipient opened the reminder', null=True)),
                ('clicked_at', models.DateTimeField(blank=True, help_text='When recipient clicked any links', null=True)),
                ('retry_count', models.PositiveIntegerField(default=0)),
                ('max_retries', models.PositiveIntegerField(default=3)),
                ('next_retry_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('appointment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='reminders', to='api.appointment')),
            ],
            options={
                'ordering': ['-scheduled_time'],
            },
        ),
        migrations.CreateModel(
            name='InAppNotification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=255)),
                ('message', models.TextField()),
                ('notification_type', models.CharField(max_length=50)),
                ('reference_id', models.CharField(blank=True, max_length=100, null=True)),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='PaymentTransaction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('transaction_id', models.CharField(help_text='Unique identifier for the transaction', max_length=100, unique=True)),
                ('_encrypted_amount', models.BinaryField(help_text='Encrypted amount for security', null=True)),
                ('amount_display', models.DecimalField(decimal_places=2, help_text='Display amount for UI', max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('currency', models.CharField(choices=[('USD', 'US Dollar'), ('EUR', 'Euro'), ('GBP', 'British Pound'), ('NGN', 'Nigerian Naira')], default='NGN', max_length=3)),
                ('payment_method', models.CharField(choices=[('card', 'Credit/Debit Card'), ('bank_transfer', 'Bank Transfer'), ('cash', 'Cash'), ('insurance', 'Insurance'), ('mobile_money', 'Mobile Money'), ('wallet', 'E-Wallet')], max_length=50)),
                ('payment_status', models.CharField(choices=[('pending', 'Pending'), ('processing', 'Processing'), ('completed', 'Completed'), ('failed', 'Failed'), ('refunded', 'Refunded')], default='pending', max_length=20)),
                ('_encrypted_insurance_data', models.BinaryField(help_text='Encrypted insurance information', null=True)),
                ('insurance_provider', models.CharField(blank=True, max_length=100, null=True)),
                ('insurance_policy_number', models.CharField(blank=True, max_length=100, null=True)),
                ('insurance_coverage_amount', models.DecimalField(decimal_places=2, default=0, max_digits=10, validators=[django.core.validators.MinValueValidator(0)])),
                ('_encrypted_gateway_data', models.BinaryField(help_text='Encrypted gateway response data', null=True)),
                ('payment_gateway', models.CharField(blank=True, help_text='Payment gateway used for processing', max_length=50, null=True)),
                ('gateway_transaction_id', models.CharField(blank=True, help_text='Transaction ID from payment gateway', max_length=100, null=True)),
                ('status_change_history', models.JSONField(default=list, help_text='History of status changes with timestamps and users')),
                ('access_log', models.JSONField(default=list, help_text='Log of users who accessed this transaction')),
                ('description', models.TextField(blank=True, help_text='Additional details about the transaction')),
                ('notes', models.TextField(blank=True, help_text='Internal notes about the transaction')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('payment_provider', models.CharField(choices=[('paystack', 'Paystack'), ('moniepoint', 'Moniepoint'), ('flutterwave', 'Flutterwave'), ('stripe', 'Stripe')], help_text='Payment provider used for processing', max_length=50, null=True)),
                ('provider_reference', models.CharField(blank=True, help_text='Reference ID from payment provider', max_length=100, null=True)),
                ('appointment', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payments', to='api.appointment')),
                ('created_by', models.ForeignKey(help_text='User who created the transaction', on_delete=django.db.models.deletion.PROTECT, related_name='created_transactions', to=settings.AUTH_USER_MODEL)),
                ('gift_sender', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sent_gift_payments', to=settings.AUTH_USER_MODEL)),
                ('hospital', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payments', to='api.hospital')),
                ('last_modified_by', models.ForeignKey(help_text='User who last modified the transaction', on_delete=django.db.models.deletion.PROTECT, related_name='modified_transactions', to=settings.AUTH_USER_MODEL)),
                ('patient', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='payments', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'permissions': [('can_view_sensitive_data', 'Can view sensitive transaction data'), ('can_process_refunds', 'Can process refunds'), ('can_view_audit_trail', 'Can view transaction audit trail')],
            },
        ),
        migrations.CreateModel(
            name='AppointmentDocument',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('document_type', models.CharField(choices=[('prescription', 'Prescription'), ('lab_report', 'Laboratory Report'), ('medical_certificate', 'Medical Certificate'), ('referral_letter', 'Referral Letter'), ('consent_form', 'Consent Form'), ('insurance_claim', 'Insurance Claim'), ('medical_history', 'Medical History'), ('test_result', 'Test Result'), ('x_ray', 'X-Ray'), ('scan', 'Scan'), ('other', 'Other')], max_length=50)),
                ('title', models.CharField(max_length=255)),
                ('description', models.TextField(blank=True)),
                ('file', models.FileField(help_text='Upload document file', upload_to='appointment_documents/%Y/%m/%d/')),
                ('file_size', models.PositiveIntegerField(editable=False, help_text='File size in bytes')),
                ('file_type', models.CharField(editable=False, help_text='MIME type of the file', max_length=50)),
                ('issued_date', models.DateTimeField(default=django.utils.timezone.now)),
                ('valid_until', models.DateField(blank=True, help_text='Document validity end date', null=True)),
                ('is_confidential', models.BooleanField(default=False, help_text='Mark document as confidential')),
                ('requires_signature', models.BooleanField(default=False, help_text='Document requires patient signature')),
                ('is_signed', models.BooleanField(default=False, help_text='Document has been signed')),
                ('signed_at', models.DateTimeField(blank=True, null=True)),
                ('version', models.PositiveIntegerField(default=1, help_text='Document version number')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('allowed_viewers', models.ManyToManyField(blank=True, help_text='Users allowed to view this document', related_name='accessible_documents', to=settings.AUTH_USER_MODEL)),
                ('appointment', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='documents', to='api.appointment')),
                ('issued_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='issued_documents', to='api.doctor')),
                ('previous_version', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='next_version', to='api.appointmentdocument')),
                ('signed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='signed_documents', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
                'indexes': [models.Index(fields=['document_type'], name='api_appoint_documen_f93914_idx'), models.Index(fields=['issued_date'], name='api_appoint_issued__eebd63_idx')],
            },
        ),
        migrations.AddIndex(
            model_name='appointment',
            index=models.Index(fields=['appointment_date'], name='api_appoint_appoint_a7bdbe_idx'),
        ),
        migrations.AddIndex(
            model_name='appointment',
            index=models.Index(fields=['status'], name='api_appoint_status_323c16_idx'),
        ),
        migrations.AddIndex(
            model_name='appointment',
            index=models.Index(fields=['appointment_id'], name='api_appoint_appoint_5f784a_idx'),
        ),
        migrations.AddIndex(
            model_name='appointmentnotification',
            index=models.Index(fields=['status', 'scheduled_time'], name='api_appoint_status_7f3065_idx'),
        ),
        migrations.AddIndex(
            model_name='appointmentnotification',
            index=models.Index(fields=['appointment', 'event_type'], name='api_appoint_appoint_2a7c66_idx'),
        ),
        migrations.AddIndex(
            model_name='appointmentreminder',
            index=models.Index(fields=['status'], name='api_appoint_status_4d0588_idx'),
        ),
        migrations.AddIndex(
            model_name='appointmentreminder',
            index=models.Index(fields=['scheduled_time'], name='api_appoint_schedul_9fbd45_idx'),
        ),
        migrations.AddIndex(
            model_name='appointmentreminder',
            index=models.Index(fields=['reminder_type'], name='api_appoint_reminde_f1f01f_idx'),
        ),
        migrations.AddIndex(
            model_name='paymenttransaction',
            index=models.Index(fields=['transaction_id'], name='api_payment_transac_e9ae05_idx'),
        ),
        migrations.AddIndex(
            model_name='paymenttransaction',
            index=models.Index(fields=['payment_status'], name='api_payment_payment_ea17e3_idx'),
        ),
        migrations.AddIndex(
            model_name='paymenttransaction',
            index=models.Index(fields=['created_at'], name='api_payment_created_bcb702_idx'),
        ),
    ]
