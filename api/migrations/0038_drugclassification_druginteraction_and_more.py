# Generated by Django 5.0.1 on 2025-11-02 13:21

import django.db.models.deletion
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0037_professionalapplication_phbprofessionalregistry_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='DrugClassification',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Unique identifier for the drug', primary_key=True, serialize=False)),
                ('generic_name', models.CharField(db_index=True, help_text='International non-proprietary name (INN) or generic name', max_length=200, unique=True)),
                ('brand_names', models.JSONField(blank=True, default=list, help_text="List of brand/trade names (e.g., ['Panadol', 'Tylenol'])")),
                ('active_ingredients', models.JSONField(blank=True, default=list, help_text='List of active ingredients with strengths')),
                ('nafdac_approved', models.BooleanField(db_index=True, default=False, help_text='Whether drug is approved by NAFDAC for use in Nigeria')),
                ('nafdac_registration_number', models.CharField(blank=True, help_text='NAFDAC registration number (e.g., A4-1234)', max_length=50, null=True)),
                ('nafdac_schedule', models.CharField(choices=[('unscheduled', 'Unscheduled (Not Controlled)'), ('schedule_1', 'Schedule 1 (Illegal - No Medical Use)'), ('schedule_2', 'Schedule 2 (High Control - Opioids)'), ('schedule_3', 'Schedule 3 (Controlled - Benzodiazepines)'), ('schedule_4', 'Schedule 4 (Monitored - Tramadol)')], db_index=True, default='unscheduled', help_text='NAFDAC controlled substance schedule', max_length=20)),
                ('nafdac_schedule_date', models.DateField(blank=True, help_text='Date drug was added to NAFDAC schedule (e.g., Tramadol in 2018)', null=True)),
                ('us_dea_schedule', models.CharField(blank=True, choices=[('not_scheduled', 'Not Scheduled'), ('schedule_1', 'DEA Schedule I'), ('schedule_2', 'DEA Schedule II'), ('schedule_3', 'DEA Schedule III'), ('schedule_4', 'DEA Schedule IV'), ('schedule_5', 'DEA Schedule V')], default='not_scheduled', help_text='US DEA controlled substance schedule', max_length=20)),
                ('uk_controlled_drug_class', models.CharField(blank=True, choices=[('not_controlled', 'Not Controlled'), ('class_a', 'Class A (Most Harmful)'), ('class_b', 'Class B (Serious Harm)'), ('class_c', 'Class C (Harmful)')], default='not_controlled', help_text='UK controlled drug classification', max_length=20)),
                ('who_essential_medicine', models.BooleanField(default=False, help_text='Listed on WHO Model List of Essential Medicines')),
                ('requires_special_prescription', models.BooleanField(default=False, help_text='Requires special prescription form (e.g., controlled substances)')),
                ('requires_physician_only', models.BooleanField(db_index=True, default=False, help_text='Only physicians can prescribe (pharmacists cannot)')),
                ('pharmacist_can_prescribe', models.BooleanField(db_index=True, default=True, help_text='Clinical pharmacists with authority can prescribe')),
                ('maximum_days_supply', models.PositiveIntegerField(blank=True, help_text='Maximum number of days that can be prescribed at once', null=True)),
                ('requires_photo_id', models.BooleanField(default=False, help_text='Patient must present photo ID to collect (e.g., controlled substances)')),
                ('therapeutic_class', models.CharField(blank=True, db_index=True, help_text="Therapeutic category (e.g., 'Analgesic', 'Antibiotic')", max_length=100)),
                ('pharmacological_class', models.CharField(blank=True, help_text="Pharmacological classification (e.g., 'Opioid', 'Beta-blocker')", max_length=100)),
                ('mechanism_of_action', models.TextField(blank=True, help_text='How the drug works (for pharmacist reference)')),
                ('is_controlled', models.BooleanField(db_index=True, default=False, help_text='Is this a controlled substance (any schedule)')),
                ('is_high_risk', models.BooleanField(db_index=True, default=False, help_text='High-risk medication requiring careful monitoring (e.g., warfarin, insulin)')),
                ('requires_monitoring', models.BooleanField(default=False, help_text='Requires routine lab/clinical monitoring')),
                ('monitoring_type', models.CharField(blank=True, help_text="Type of monitoring required (e.g., 'INR', 'kidney_function', 'blood_glucose')", max_length=100)),
                ('monitoring_frequency_days', models.PositiveIntegerField(blank=True, help_text='How often monitoring is needed (in days, e.g., 30 for monthly)', null=True)),
                ('addiction_risk', models.BooleanField(default=False, help_text='Drug has significant addiction/dependence potential')),
                ('abuse_potential', models.CharField(choices=[('none', 'No Abuse Potential'), ('low', 'Low'), ('moderate', 'Moderate'), ('high', 'High'), ('severe', 'Severe')], default='none', help_text='Potential for substance abuse', max_length=20)),
                ('minimum_age', models.PositiveIntegerField(blank=True, help_text='Minimum age in years (e.g., 18 for controlled substances)', null=True)),
                ('maximum_age', models.PositiveIntegerField(blank=True, help_text='Maximum age in years (if applicable, e.g., pediatric medications)', null=True)),
                ('pregnancy_category', models.CharField(choices=[('A', 'Category A - Safe in pregnancy'), ('B', 'Category B - Probably safe'), ('C', 'Category C - Risk cannot be ruled out'), ('D', 'Category D - Positive evidence of risk'), ('X', 'Category X - Contraindicated in pregnancy'), ('N', 'Not Categorized')], default='N', help_text='FDA pregnancy risk category', max_length=1)),
                ('breastfeeding_safe', models.BooleanField(default=True, help_text='Safe for breastfeeding mothers')),
                ('major_contraindications', models.JSONField(blank=True, default=list, help_text='List of medical conditions where drug is contraindicated')),
                ('allergy_cross_reactions', models.JSONField(blank=True, default=list, help_text='Drugs/substances that may cause cross-allergic reactions')),
                ('black_box_warning', models.BooleanField(default=False, help_text='FDA black box warning (most serious warning)')),
                ('black_box_warning_text', models.TextField(blank=True, help_text='Text of black box warning')),
                ('major_drug_interactions', models.JSONField(blank=True, default=list, help_text='List of drug names with major interactions (detailed interactions in DrugInteraction model)')),
                ('food_interactions', models.JSONField(blank=True, default=list, help_text='Foods that interact with this drug (e.g., grapefruit juice)')),
                ('search_keywords', models.JSONField(blank=True, default=list, help_text='All possible spellings, abbreviations, and variants for matching')),
                ('generic_variations', models.JSONField(blank=True, default=list, help_text='Alternative generic names or spellings')),
                ('common_misspellings', models.JSONField(blank=True, default=list, help_text="Common misspellings to catch (e.g., 'paracetamol' vs 'paracetomol')")),
                ('safer_alternatives', models.JSONField(blank=True, default=list, help_text='List of safer alternative drugs (generic names)')),
                ('cheaper_alternatives', models.JSONField(blank=True, default=list, help_text='List of more affordable alternatives')),
                ('notes', models.TextField(blank=True, help_text='Internal notes for pharmacists/administrators')),
                ('external_references', models.JSONField(blank=True, default=dict, help_text='Links to external databases (FDA, WHO, etc.)')),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Drug is active in system (set False if discontinued)')),
                ('discontinued', models.BooleanField(default=False, help_text='Drug has been discontinued/withdrawn from market')),
                ('discontinued_date', models.DateField(blank=True, help_text='Date drug was discontinued', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('last_verified_date', models.DateField(blank=True, help_text='Last date data was verified by medical professional', null=True)),
                ('verified_by', models.CharField(blank=True, help_text='Name/ID of person who verified this data', max_length=200)),
            ],
            options={
                'verbose_name': 'Drug Classification',
                'verbose_name_plural': 'Drug Classifications',
                'db_table': 'drug_classifications',
                'ordering': ['generic_name'],
                'indexes': [models.Index(fields=['generic_name'], name='idx_drug_generic'), models.Index(fields=['nafdac_schedule'], name='idx_drug_nafdac_schedule'), models.Index(fields=['therapeutic_class'], name='idx_drug_therapeutic'), models.Index(fields=['is_controlled', 'is_high_risk'], name='idx_drug_risk_flags'), models.Index(fields=['pharmacist_can_prescribe'], name='idx_drug_pharm_prescribe'), models.Index(fields=['is_active'], name='idx_drug_active')],
            },
        ),
        migrations.CreateModel(
            name='DrugInteraction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, help_text='Unique identifier for the interaction', primary_key=True, serialize=False)),
                ('interaction_severity', models.CharField(choices=[('mild', 'Mild - Usually no clinical intervention needed'), ('moderate', 'Moderate - Monitor patient, may need intervention'), ('severe', 'Severe - Requires intervention or close monitoring'), ('contraindicated', 'Contraindicated - Do not prescribe together')], db_index=True, help_text='Severity level of the interaction', max_length=20)),
                ('clinical_effect', models.TextField(help_text='Description of what happens when drugs are taken together')),
                ('mechanism', models.TextField(blank=True, help_text='Pharmacological mechanism of the interaction')),
                ('onset_timing', models.CharField(blank=True, choices=[('rapid', 'Rapid (within hours)'), ('delayed', 'Delayed (days to weeks)'), ('variable', 'Variable')], help_text='How quickly the interaction occurs', max_length=50)),
                ('management_strategy', models.TextField(help_text='How to manage this interaction clinically')),
                ('alternative_recommendation', models.TextField(blank=True, help_text='Suggested alternative medications to avoid interaction')),
                ('monitoring_required', models.BooleanField(default=False, help_text='Whether monitoring is required if drugs must be used together')),
                ('monitoring_parameters', models.TextField(blank=True, help_text='What to monitor (e.g., INR, blood pressure, renal function)')),
                ('evidence_level', models.CharField(choices=[('well_documented', 'Well-Documented (Multiple clinical studies)'), ('suspected', 'Suspected (Case reports or theoretical)'), ('theoretical', 'Theoretical (Based on pharmacology, not clinical data)')], default='suspected', help_text='Level of evidence for this interaction', max_length=20)),
                ('references', models.JSONField(blank=True, default=list, help_text='List of references/studies documenting this interaction')),
                ('external_links', models.JSONField(blank=True, default=dict, help_text='Links to external resources (FDA alerts, Drugs.com, etc.)')),
                ('frequency_of_occurrence', models.CharField(blank=True, choices=[('rare', 'Rare (<1%)'), ('uncommon', 'Uncommon (1-10%)'), ('common', 'Common (10-50%)'), ('very_common', 'Very Common (>50%)')], help_text='How often this interaction occurs clinically', max_length=20)),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Interaction is active in system')),
                ('notes', models.TextField(blank=True, help_text='Internal notes for pharmacists')),
                ('created_at', models.DateTimeField(auto_now_add=True, help_text='When this interaction was added to database')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this interaction was last updated')),
                ('last_verified_date', models.DateField(blank=True, help_text='Last date this interaction was verified', null=True)),
                ('verified_by', models.CharField(blank=True, help_text='Name/ID of person who verified this interaction', max_length=200)),
                ('drug_a', models.ForeignKey(help_text='First drug in the interaction', on_delete=django.db.models.deletion.CASCADE, related_name='interactions_as_drug_a', to='api.drugclassification')),
                ('drug_b', models.ForeignKey(help_text='Second drug in the interaction', on_delete=django.db.models.deletion.CASCADE, related_name='interactions_as_drug_b', to='api.drugclassification')),
            ],
            options={
                'verbose_name': 'Drug Interaction',
                'verbose_name_plural': 'Drug Interactions',
                'db_table': 'drug_interactions',
                'ordering': ['-interaction_severity', 'drug_a__generic_name', 'drug_b__generic_name'],
                'indexes': [models.Index(fields=['drug_a', 'interaction_severity'], name='idx_interaction_drug_a'), models.Index(fields=['drug_b', 'interaction_severity'], name='idx_interaction_drug_b'), models.Index(fields=['interaction_severity'], name='idx_interaction_severity'), models.Index(fields=['is_active'], name='idx_interaction_active')],
            },
        ),
        migrations.AddConstraint(
            model_name='druginteraction',
            constraint=models.UniqueConstraint(fields=('drug_a', 'drug_b'), name='unique_drug_pair'),
        ),
    ]
